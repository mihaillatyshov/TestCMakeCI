name: CMake

on:
    push:
        branches: ["dev"]
    pull_request:
        branches: ["dev"]

env:
    BUILD_TYPE: Release

jobs:
    build:
        runs-on: ubuntu-latest
        container: reddir666/dnd-pqxx-gtest

        steps:
            - uses: actions/checkout@v3

            - name: Configure CMake
              run: cmake -B ${{github.workspace}}/build -DCMAKE_BUILD_TYPE=${{env.BUILD_TYPE}}

            - name: Build
              run: cmake --build ${{github.workspace}}/build --config ${{env.BUILD_TYPE}}

            #- name: Test
            #  working-directory: ${{github.workspace}}/build
            #  run: ctest -C ${{env.BUILD_TYPE}}

    #check:

    tests:
        runs-on: ubuntu-latest
        container: reddir666/dnd-pqxx-gtest
        needs: [build]

        steps:
            - uses: actions/checkout@v3

            - name: Run client tests
              working-directory: ./build/client/test
              run: ctest -C ${{env.BUILD_TYPE}} --output-on-failure
